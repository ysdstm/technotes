## 学习正则表达式

书中的测试工具RegExr，可以使用在线工具`http://regexr.com/v1/`，也可以使用推荐的v2版本`http://regexr.com`

### 第1章 什么是正则表达式

#### 1.2 匹配北美电话号码

例如：  
707-825-7019 或 (707)-825-7019  

#### 1.3 使用字符组匹配数字

匹配数字`[0-9]`  

正则表达式将方括号视为特殊的`元字符`，因此方括号不参与匹配  
`元字符`是在正则表达式中有特殊含义的字符，也是保留字符  
`[0-9]`这种形式的正则表达式称作`字符组`，也叫`字符集`  

进一步限定数字，可以是`[012789]`  

#### 1.4 使用字符组简写式

`\d`也可以匹配任意阿拉伯数字，相当于`[0-9]`  
这种正则表达式叫做`字符组简写式`，也叫`转移字符`，但很容易造成误解  
`\D`则表示任意一个非数字字符  

#### 1.5 匹配任意字符

点号`.`是一个通配符，可以匹配任意字符，某些情况下不能匹配行起始符，比如换行符(U+000A)    

#### 1.6 捕获分组和后向引用

要创建捕获分组，需要将匹配字符的正则表达式放在括号中，例如(\d)  
反向引用使用\1来捕获，(\d)\d\1匹配电话号码中的区号707，\1表示捕获的第1个字符或字符串  

#### 1.7 使用量词

`\d{3}-?\d{3}-?\d{4}`,花括号中的数字标识待查找的数字出现的次数，包含数字的花括号是一种`量词`，花括号本身用作`元字符`  

问号`?`是另一种量词，在以上表示连字符可以不出现或者出现一次  
加号`+`表示出现一次或多次  
星号`*`表示出现零次或多次  

`(\d{3,4}[.-]?)+`  

数字3和4表示匹配的最小和最大数量，方括号表示字符组，问号表示量词零个或一个，加号表示量词一个或多个  

改进：只能匹配三位数字-三位数字-四位数字  
`(\d{3}[.-]?){2}\d{4}`  

1.8 括选文字符

可以带区号也可以不带区号，区号可以带括号也可以不带括号  

`^(\(\d{3}\)|^\d{3}[.-]?)?\d{3}[.-]?\d{4}$`  

分解：  

	^				#左分界符，表示一行的起始位置
	(				#捕获分组的左起始符
		\(\d{3}\)	#区号的左右括号，\(和\)表示括号本身
		|			#标识可以从多个可选项中选择一个
		^\d{3}[.-]?	#区号不带括号的版本
	)				#捕获分组的结束符
	?				#匹配0个或1个，表示区号前缀可有可无
	\d{3}[.-]?		#匹配电话号码的第二段
	\d{4}			#匹配电话号码的第三段
	$				#美元符$匹配行结束位置，如果号码后面有其他字符，则不能匹配该行的号码

该正则表达式可以匹配以下格式的电话号码，-可以替换成.   
这里只是为了适配markdown语法，添加了缩进  

	111-2222
	111-222-3333
	(111)222-3333
	(111)2223333

### 第2章 简单的匹配模式

介绍匹配模式的简单方法：  

* 字符串字面值
* 数字
* 字母
* 任意字符

文本举例参见`https://github.com/michaeljamesfitzgerald/Introducing-Regular-Expressions`中的rime-intro.txt  

	THE RIME OF THE ANCYENT MARINERE, IN SEVEN PARTS.

	ARGUMENT.

	How a Ship having passed the Line was driven by Storms to the cold
	Country towards the South Pole; and how from thence she made her course
	to the tropical Latitude of the Great Pacific Ocean; and of the strange
	things that befell; and in what manner the Ancyent Marinere came back to
	his own Country.

	I.

	1      It is an ancyent Marinere,
	2        And he stoppeth one of three:
	3      "By thy long grey beard and thy glittering eye
	4        "Now wherefore stoppest me?

#### 2.1 匹配字符串字面值

正则表达式最直接和明显的功能就是用一个或多个字符字面值来匹配字符串。  
例如搜索Ship来匹配文档中的Ship  

#### 2.2 匹配数字

可以使用简写式`\d`或者使用字符组`[0-9]`，或者只需要匹配0和1，则`[01]`  

#### 2.3 匹配非数字字符

通常可以将简写式取反，取反的结果就是排除  

使用大写字母`\D`或者`[^0-9]`或者`[^\d]`  

#### 2.4 匹配单词和非单词字符

`\w`和`\D`的区别是  
\D会匹配所有字符，包括空格、标点符号（引号、连字符、反斜杠、方括号）等  
\w只能匹配字母、数字和下划线  

在英语环境中，与\w匹配的相通内容的字符组为：  
`[_a-zA-Z0-9]`  

> 第6章学习怎样匹配非英文字符

大写字母W匹配非单词字符，匹配空格、标点、及其他飞字母、非数字字符：  
`\W`  

字符组也可以匹配相通的内容：  
`[^_a-zA-Z0-9]`  

其他字符简写式，不是所有的正则表达式处理器都能识别这些简写式：  

	\a      报警符
	[\b]    退格字符
	\c x    控制字符
	\d      数字字符
	\D      非数字字符
	\o xxx  字符的八进制值
	\w      单词字符
	\W      非单词字符
	\0      空字符
	\x xx   字符的十六进制值
	\u xxx  字符的Unicode值

#### 2.5 匹配空白符

简写式`\s`可以匹配空白符，字符组的表示为[ \t\n\r]：  

* 空格
* 制表符(\t)
* 换行符(\n)
* 回车符(\r)

> 空格和制表符会被高亮显示，但换行符和回车符不会

>回车符(CR)与换行符(LF)， '\r'和'\n'的区别

	回车”（Carriage Return）和“换行”（Line Feed）这两个概念的来历和区别。
	在计算机还没有出现之前，有一种叫做电传打字机（Teletype Model 33，Linux/Unix下的tty概念也来自于此）的玩意，每秒钟可以打10个字符。但是它有一个问题，就是打完一行换行的时候，要用去0.2秒，正 好可以打两个字符。要是在这0.2秒里面，又有新的字符传过来，那么这个字符将丢失。

	于是，研制人员想了个办法解决这个问题，就是在每行后面加两个表示结束的字符。一个叫做“回车”，告诉打字机把打印头定位在左边界；另一个叫做“换行”，告诉打字机把纸向下移一行。这就是“换行”和“回车”的来历，从它们的英语名字上也可以看出一二。

	后来，计算机发明了，这两个概念也就被般到了计算机上。那时，存储器很贵，一些科学家认为在每行结尾加两个字符太浪费了，加一个就可以。于是，就出现了分歧。

	Unix系统里，每行结尾只有“<换行>”，即"\n"；Windows系统里面，每行结尾是“<换行><回 车>”，即“\r\n”；Mac系统里，每行结尾是“<回车>”，即"\n"；。一个直接后果是，Unix/Mac系统下的文件在 Windows里打开的话，所有文字会变成一行；而Windows里的文件在Unix/Mac下打开的话，在每行的结尾可能会多出一个^M符号。

大写的S表示非空白字符`\S`，匹配字符组`[^ \t\n\r]`，或者`[^\s]`  

匹配各种空白符的简写式：  

	\f    换页符
	\h    水平空白符
	\H    非水平空白符
	\n    换行符
	\r    回车符
	\s    空白符
	\S    非空白符
	\t    水平制表符
	\v    垂直制表符
	\V    非垂直制表符

#### 2.6 再谈匹配任意字符

点号`.`匹配除结束符之外的所有字符，匹配8个长度的字符`.{8}`  

`\bA.{5}T\b`匹配单词ANCYENT，见rime-intro：  

* \b匹配单词的边界，不消耗任何字符
* 字符A和T限定了字符序列的首位字母
* .{5}匹配任意5个字符
* \b匹配单词的另一个边界

再试一下`\b\w{7}\b`：  

* \w{7}匹配长度为7的字符，也就是长度为7的所有单词，注意并不能匹配中文字符  

再试试`.*`，0个或多个字符，相当于`[^\n]`或者[^\n\r]  

`.+`，点号与表示一个或多个的量词`+`连用，该表达式匹配第一行的内容，（在取消勾选Global复选框的情况下），原因是点好通常不会匹配换行符或回车符  
> 正则表达式的贪婪特性，见第7章

#### 2.7 给文本加标签

在查找框内输入`(^T.*)`，在替换框内输入`<h1>$1</h1>`  
将把第1行的两端加上<h1>标签

#### 2.7.1 用sed为文本加标签

#### 2.7.2 用Perl为文本加标签

### 第3章 边界

本章的重点是断言。断言标记边界，但不耗用字符。  
也就是说，字符并不会返回到结果中。  
断言也被称为零宽度断言。零宽度断言不匹配字符，而是字符串中的位置。其中的^和$，也叫做锚位符。  

本章讨论的边界有以下几种：

* 行或者字符串的起始与结束位置
* 单词边界（两种）
* 主题词的起始与结束位置
* 引用字符串字面值的边界